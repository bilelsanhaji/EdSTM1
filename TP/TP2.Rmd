---
title: "Économétrie des Séries Temporelles"
author: "Fiche TD `R` #2"
date: "Processus ARMA stationnaires"
output: pdf_document
#output:
 # html_document:
  #  mathjax: default
---
 
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  error = TRUE,
  fig.width = 10, 
  fig.height = 5,
  dpi = 600,
  fig.keep ="last",
  message = FALSE,
  warning = FALSE,
  results = "markup"
)
```

### Packages

```{r bibliotheques}
library(readr)
library(zoo)
library(astsa)
library(forecast)
library(stats)
library(tseries)
library(aTSA)
#install.packages("aTSA")
```

### Données (identiques au TP1)

Nice : <https://github.com/bilelsanhaji/EdSTM1/blob/main/Data/SH_MIN006088001.csv>

Paris : <https://github.com/bilelsanhaji/EdSTM1/blob/main/Data/SH_MIN175114001.csv>

```{r DataImport}
urlSHnice <- "https://raw.githubusercontent.com/bilelsanhaji/EdSTM1/refs/heads/main/Data/SH_MIN006088001.csv"
InsoNice <- read_delim(urlSHnice, 
                       delim = ";",
                       escape_double = FALSE,
                       col_types = cols(YYYYMM = col_date(format = "%Y%m")), 
                       comment = "#", trim_ws = TRUE)

urlSHparis <- "https://raw.githubusercontent.com/bilelsanhaji/EdSTM1/refs/heads/main/Data/SH_MIN175114001.csv"
InsoParis <- read_delim(urlSHparis,
                        delim = ";",
                        escape_double = FALSE,
                        col_types = cols(YYYYMM = col_date(format = "%Y%m")),
                        comment = "#", trim_ws = TRUE)
```
```{r value}
Nice_ts = ts(InsoNice$VALEUR)
Paris_ts = ts(InsoParis$VALEUR)
```


### Exercice 1

À partir des données d'insolation de Nice et Paris, utilisez les séries pour

(a) donner une représentation graphique et tester statistiquement :

1.  la stationarité
```{r, fig.keep='last'}
tsplot(Nice_ts)
abline(h = mean(Nice_ts), col = "red", lty = 3, lwd = 2)
```

```{r}
tseries::adf.test(Nice_ts)
```
```{r}
aTSA::adf.test(Nice_ts)
```
2. l'autocorrélation
```{r}
acf(Nice_ts)
```
```{r}
acf(Paris_ts)
```

```{r}
Box.test(Nice_ts, lag = 6, type = "Box-Pierce")
?Box.test
```
```{r}
Box.test(Paris_ts, lag = 6, type = "Box-Pierce")
```


3. la normalité
```{r, fig.keep='last'}
hist(Nice_ts, freq = F, ylim=c(0,0.006))
lines(density(Nice_ts), col="darkred", lwd = 3)
lines(density(rnorm(n = length(Nice_ts), mean = mean(Nice_ts), sd = sd(Nice_ts) )), col="darkgreen", lwd = 2)
```

```{r}
qqnorm(Nice_ts)
qqline(Nice_ts, col="darkred", lwd = 2)
```
```{r}
#shapiro.test(Nice_ts)
jarque.bera.test(Nice_ts)
```

(b) estimer et interpréter un AR(1) pour chaque série, puis, sur les résidus :

1.  refaire les tests effectués dans la partie (a) + l'hétéroscédasticité
2.  interprétez tous les résultats obtenus
3.  discutez la différence qu'il y a entre les séries

### Exercice 2

Simulez un processus AR(1) stationnaire avec 50 observations. Puis

(a) "testez" graphiquement et testez statistiquement :

1.  la stationarité
2.  l'autocorrélation
3.  la normalité
4.  l'hétéroscédasticité

(b) estimez la série simulée et discutez les résultats
(c) reproduire les étapes (a) et (b) avec 5000 observations
